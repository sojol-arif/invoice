$(document).ready(function(){ 
    /* dynamic input field */
    $.fn.textWidth = function(text, font) {
    
        if (!$.fn.textWidth.fakeEl) $.fn.textWidth.fakeEl = $('<span>').hide().appendTo(document.body);
        
        $.fn.textWidth.fakeEl.text(text || this.val() || this.text() || this.attr('placeholder')).css('font', font || this.css('font'));
        
        return $.fn.textWidth.fakeEl.width();
    };
    $('.form-control').on('input', function() {
        var inputWidth = $(this).textWidth();
        $(this).css({
            width: inputWidth
        })
    }).trigger('input');
    function inputWidth(elem, minW, maxW) {
        elem = $(this);
        console.log(elem)
    }
    var targetElem = $('.form-control');
    inputWidth(targetElem);
    /* dynamic input field end */

    /* auto increase textarea */
    var x = document.getElementsByClassName("textarea");
    var i;
    for (i = 0; i < x.length; i++) {
      autosize(x[i]);
    }
    autosize(document.getElementById('textarea-one'));
    $('.ic-dropdown').on( 'change keyup keydown paste cut', 'textarea', function (){
        $(this).height(0).height(this.scrollHeight);
    }).find( 'textarea' ).change();
    /* auto increase textarea */



    /*select*/
    $(".ic-select").chosen({

    });
    $(".ic-select-of-table").chosen({
        "disable_search": true,
    });
    /* Image file upload in banner */
    function readURL2(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#banner-img').css('display', "block");
                $('#banner-img').attr('src', e.target.result);
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    $("#banner-input").change(function(){
        readURL2(this);
    });

    /* drop image banner */
    $('.drop-image-delete').click(function(){
        $('#banner-img').attr('src', '');
    });

    /* select placeholder add class form control */
    $('.chosen-container-single .chosen-single span').click(function(event){
        event.stopPropagation();
        $(this).addClass('box-shadow');
    });

    $('.chosen-drop').click(function(event){
        event.stopPropagation();
    });
    /* select placeholder add class form control */
    $('.ic-invoice .heading .chosen-container-single .chosen-single span').click(function(){
        $(this).addClass('box-shadow');
    });
    $('body').click(function(){
        $('.ic-invoice .heading .chosen-container-single .chosen-single span').removeClass('box-shadow');
        $('.chosen-container-single .chosen-single span').removeClass('box-shadow');
    });

    /* date picker */
    // $('#ic-datepicker').datepicker({
    //     uiLibrary: 'bootstrap4'
    // });
    $('.ic-datepicker').datepicker();
    $('.ic-datepicker-two').datepicker();

    /** tab btn click show tabContent*/
    $('.ic-tab-btn').click(function(){
        $('#v-pills-tabContent').addClass('active');
        /*first child focus */
        $('.ic-edit-change-client').addClass('ic-d-none');
        $(this).hide();
    });

    $('.ic-client-input-field-div .form-control').click(function(event){
        event.stopPropagation();
    })
    $('.ic-select-custom-dropdown').click(function(event){
        event.stopPropagation();
    })


    /* event prevent defautl */
    $('.close-btn-tbl, .del, .ic-canel-add-discount, .ic-add-discount-btn').click(function(event){
        event.preventDefault();
    });

    $('.textarea.tbl').val($('.chosen-container-single .chosen-single span').text());
    

    /** custom dropdown select */
    var allOptions = $(".ic-select-custom-dropdown").children('li:not(.placeholder)');
    $(".ic-select-custom-dropdown").on("click", "li:not(.placeholder)", function() {
        allOptions.removeClass('selected');
        $(this).addClass('selected');
        $(".ic-select-custom-dropdown").children('.placeholder').html($(this).html());
    });
    $('.ic-select-custom-dropdown .placeholder').click(function(){
        $(this).attr("contenteditable","true");
    });


    /** dropdown with search filter aside */
    /** set dropdown value to input value */
    /* bind value and width */
    $('#v-pills-tabContent .ic-select-custom-dropdown li').click(function(){
        /* value and width */
        $(this).parent().siblings('.ic-inline').find('.ic-first-name').val($(this).find('.ic-client-first-name').text());
        $(this).parent().siblings('.ic-inline').find('.ic-first-name').width($(this).find('.ic-client-first-name').width());;
        /** -- */
        $(this).parent().siblings('.ic-inline').find('.ic-last-name').val($(this).find('.ic-client-last-name').text());
        $(this).parent().siblings('.ic-inline').find('.ic-last-name').width($(this).find('.ic-client-last-name').width());
        /** -- */
        $(this).parent().siblings('.form-group').find('.ic-company-name').val($(this).find('.ic-client-company-name').text());
        $(this).parent().siblings('.form-group').find('.ic-company-name').width($(this).find('.ic-client-company-name').width());
        /** -- */
        $(this).parent().siblings('.form-group').find('.ic-stree-address').val($(this).find('.ic-client-street-address').text());
        $(this).parent().siblings('.form-group').find('.ic-stree-address').width($(this).find('.ic-client-street-address').width());
        /** -- */
        $(this).parent().siblings('.ic-inline').find('.ic-city-name').val($(this).find('.ic-client-city').text());
        $(this).parent().siblings('.ic-inline').find('.ic-city-name').width($(this).find('.ic-client-city').width());
        /** -- */
        $(this).parent().siblings('.ic-inline').find('.ic-state').val($(this).find('.ic-client-state').text());
        $(this).parent().siblings('.ic-inline').find('.ic-state').width($(this).find('.ic-client-state').width());
                /** -- */
        $(this).parent().siblings('.form-group').find('.ic-zip-code').val($(this).find('.ic-client-zip-code').text());
        $(this).parent().siblings('.form-group').find('.ic-zip-code').width($(this).find('.ic-client-zip-code').width());
        /** dropdown hide when click child */
        $(this).parent().addClass('ic-hide');
    });
    
    /* focus active dropdown */
    $('#v-pills-tabContent .form-control').focus(function(){
        $('#v-pills-tabContent .ic-select-custom-dropdown').removeClass('ic-hide');
    });
    /* jquery search filter */
    $("#v-pills-tabContent .form-control").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $(this).parent().siblings().children(".ic-select-custom-dropdown > li").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
        
    });
    $("#v-pills-tabContent .form-control").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $(this).parent().parent().siblings().children(".ic-select-custom-dropdown > li").filter(function() {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
        
    });
    
    $('body').click(function(){
        // $('#v-pills-tabContent .ic-select-custom-dropdown').addClass('ic-hide');
        /** ic-tab-btn body click show */
        // if($('#v-pills-tabContent .form-control').val()==0){
        //     $('.ic-tab-btn').show();
        // }
    })

    $('.ic-select-custom-dropdown').click(function(e){
        e.stopPropagation();
    });
    $('#v-pills-tabContent .form-control').click(function(e){
        e.stopPropagation();
    });
    $('#v-pills-tabContent .ic-select-custom-dropdown').click(function(e){
        e.stopPropagation();
    })
    /** dropdown with search filter aside end */


    /** dropdown with search filter body table */
    /** set dropdown value to textarea value */
    $('.ic-select-custom-dropdown li').click(function(){
        $(this).parent().siblings().val($(this).text());
    });
    /** dropdown hide when click child */
    $('.ic-select-custom-dropdown li').click(function(){
        $(this).parent('.ic-select-custom-dropdown').removeClass('active');
    });

    /* focus active dropdown */
    $('.ic-textarea-btn').focus(function(){
        $('.ic-select-custom-dropdown').removeClass('active');
        $(this).siblings('.ic-select-custom-dropdown').addClass('active');
    });
    /* jquery search filter */
    $(".ic-textarea-btn").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $(this).siblings().children(".ic-select-custom-dropdown > li").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
        });
    });
    
    $('body').click(function(){
        $('.ic-select-custom-dropdown').removeClass('active');
    })

    $('.ic-select-custom-dropdown').click(function(e){
        e.stopPropagation();
    });
    $('.ic-textarea-btn').click(function(e){
        e.stopPropagation();
    });
    /** dropdown with search filter body table end */

    /** ic-change-client */
    $('.ic-edit-change-client .ic-change-client').click(function(e){
        e.stopPropagation();
        /** value null */
        $('#v-pills-tabContent .form-control').val('');
        /** input width fix */
        $.fn.textWidth = function(text, font) {
    
            if (!$.fn.textWidth.fakeEl) $.fn.textWidth.fakeEl = $('<span>').hide().appendTo(document.body);
            
            $.fn.textWidth.fakeEl.text(text || this.val() || this.text() || this.attr('placeholder')).css('font', font || this.css('font'));
            
            return $.fn.textWidth.fakeEl.width();
        };
        $('.form-control').on('input', function() {
            var inputWidth = $(this).textWidth();
            $(this).css({
                width: inputWidth
            })
        }).trigger('input');
        function inputWidth(elem, minW, maxW) {
            elem = $(this);
            console.log(elem)
        }
        var targetElem = $('.form-control');
        inputWidth(targetElem);
        
        /** show dropdown all stored */
        $('#v-pills-tabContent .ic-select-custom-dropdown').removeClass('ic-hide');
        $('#v-pills-tabContent .ic-select-custom-dropdown').addClass('active');

        /*first child focus */
        $('#v-pills-tabContent .ic-first-name').focus();
        
        $(this).closest('ul').addClass('ic-d-none');
    });
    /** ic-change-client end*/

    /** ic-edit-client */
    $('.ic-edit-change-client .ic-edit-client').click(function(e){
        e.stopPropagation();

        /*first child focus */
        $('#v-pills-tabContent .ic-first-name').focus();
        /* hide stored dropdown */
        $('#v-pills-tabContent .ic-select-custom-dropdown').addClass('ic-hide');
        $(this).closest('ul').addClass('ic-d-none');
    });
    /** ic-edit-client end */

    /** add a discount */
    $('.ic-add-discount-btn').click(function(){
        $('.ic-add-discount-dropdown').toggleClass('active');
    });

    $('.ic-percentage-input').keyup(function() {
        $('.ic-add-text').html($(this).val());
    });
    
    
    /** body click hide dropdown add discount */
    $('body').click(function(){
        $('.ic-add-discount-dropdown').removeClass('active');
    });

    $('.ic-add-discount-btn').click(function(e){
        e.stopPropagation();
    });
    $('.ic-add-discount-dropdown').click(function(e){
        e.stopPropagation();
    });

    /** cacel add discount value */
    $('.ic-canel-add-discount').click(function(){
        $('.ic-add-text').text('Add');
    });
});


/** dropdown pure onclick */
// $(document).on("keyup", ".ic-select-custom-dropdown", function(event) {

//     // GOOD TO STORE THIS IN A VAR
//     // PREVENTS THE BROWSER HAVING TO 
//     // FIGURE OUT WHAT $(this) IS
//     // EACH TIME YOU CALL IT
//     var element = $(this);
  
//     // KEYUP  
//     if (event.type == "keyup") {
  
//       var maximumLength = element.attr("data-maxlength");
//       var currentLength = element.text().length;
//       var content = element.text();
  
//       // CURRENT LENGTH IS GREATER THAN
//       // THE SPECIFIED MAXIMUM LENGTH
//       if (currentLength > maximumLength) {
//         var over = element.html().substr(maximumLength);
//         over = "<span class='highlight'>" + over + "</span>";
//         content = element.html().substr(0, maximumLength) + over;
//       }
//       $(".ic-select-custom-dropdown").html(content);
  
//     }
  
// });

    /** custom ul li select dropdown two */
    //
// ul-select
// https://github.com/zgreen/ul-select
//

$.fn.ulSelect = function(){
    var ul = $(this);
  
    if (!ul.hasClass('zg-ul-select')) {
      ul.addClass('zg-ul-select');
    }
    // SVG arrow
    var arrow = '<svg id="ul-arrow" xmlns="http://www.w3.org/2000/svg" version="1.1" width="32" height="32" viewBox="0 0 32 32"><line stroke-width="1" x1="" y1="" x2="" y2="" stroke="#449FDB" opacity=""/><path d="M4.131 8.962c-0.434-0.429-1.134-0.429-1.566 0-0.432 0.427-0.432 1.122 0 1.55l12.653 12.528c0.434 0.429 1.133 0.429 1.566 0l12.653-12.528c0.432-0.429 0.434-1.122 0-1.55s-1.136-0.429-1.566-0.002l-11.87 11.426-11.869-11.424z" fill="#111"/></svg>';
    $('li:first-of-type', this).addClass('active').append(arrow);
    $(this).on('click', 'li', function(event){
      
      // Remove div#selected if it exists
      if ($('#selected--zg-ul-select').length) {
        $('#selected--zg-ul-select').remove();
      }
      ul.before('<div id="selected--zg-ul-select">');
      var selected = $('#selected--zg-ul-select');
      $('li #ul-arrow', ul).remove();
      ul.toggleClass('active');
      // Remove active class from any <li> that has it...
      ul.children().removeClass('active');
      // And add the class to the <li> that gets clicked
      $(this).toggleClass('active');
  
      var selectedText = $(this).text();
      if (ul.hasClass('active')) {
        selected.text(selectedText).addClass('active').append(arrow);
      }
      else {
        selected.text('').removeClass('active'); 
        $('li.active', ul).append(arrow);
      }
      });
      // Make ul tabbable
      /*$(ul).focus(function(){
       $(this).keydown(function(e) {
        if(e.which == 38 || 40) { // Up or down keypress
          $(this).addClass('active');
          var liActive =  $('li.active', ul);
          var liPrev = $('li.active', ul).prev();
          var liNext =  $('li.active', ul).next();
          if(e.which == 38) { // Down
            liActive.removeClass('active');
            liPrev.addClass('active');
          }
          if(e.which == 40) { // Down
            liActive.removeClass('active');
            liNext.addClass('active');
          }
        }
       });
       $(this).keydown(function(){
          if(e.which == 13) { // Down
            ul.removeClass('active');
          }
        });
      });*/
      // Close the faux select menu when clicking outside it 
      $(document).on('click', function(event){
      if($('ul.zg-ul-select').length) {
       if(!$('ul.zg-ul-select').has(event.target).length == 0) {
        return;
      }
      else {
        $('ul.zg-ul-select').removeClass('active');
        $('#selected--zg-ul-select').removeClass('active').text('');
        $('#ul-arrow').remove();
        $('ul.zg-ul-select li.active').append(arrow);
      } 
      }
      });
    }
  
  // Run
  $('.ic-country').ulSelect();